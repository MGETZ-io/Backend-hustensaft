<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Hustensaft Login</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .login-card { background: #1e1e1e; padding: 2.5rem; border-radius: 15px; width: 350px; transition: transform 0.7s ease-in-out, opacity 0.5s; box-shadow: 0 15px 35px rgba(0,0,0,0.6); text-align: center; border: 1px solid #333; }
        .rotated { transform: rotate(360deg) scale(0); opacity: 0; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #444; border-radius: 8px; background: #2a2a2a; color: white; box-sizing: border-box; outline: none; }
        input:focus { border-color: #007bff; }
        button { width: 100%; padding: 12px; background: #007bff; border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 15px; transition: background 0.3s; }
        button:hover { background: #0056b3; }
        .forgot-btn { background: none; color: #666; font-size: 0.85rem; text-decoration: underline; cursor: pointer; border: none; margin-top: 20px; }
        #forgotPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #252525; padding: 25px; border-radius: 12px; z-index: 100; width: 300px; border: 1px solid #007bff; box-shadow: 0 0 20px rgba(0,123,255,0.4); }
    </style>
</head>
<body>

    <div class="login-card" id="card">
        <h1 style="margin-bottom: 20px; font-size: 1.5rem;">Hustensaft Backend</h1>
        <input type="text" id="username" placeholder="Benutzername">
        <input type="password" id="password" placeholder="Passwort">
        <button onclick="handleLogin()">Login</button>
        <button class="forgot-btn" onclick="openForgot()">Passwort vergessen?</button>
    </div>

    <div id="forgotPopup">
        <h3 style="margin-top:0;">Support Anfrage</h3>
        <input type="text" id="fUser" placeholder="Nutzername">
        <input type="text" id="fOld" placeholder="Altes Passwort">
        <input type="text" id="fNew" placeholder="Neues Wunsch-Passwort">
        <button onclick="sendDiscord()" style="background: #28a745;">Anfrage senden</button>
        <button onclick="closeForgot()" style="background:#555; margin-top:5px;">Abbrechen</button>
    </div>

    <script>
        // API Pfad auf der Hauptdomain
        const API_BASE = "https://hustensaft.org/api/apiv2/secret/login";
        const WEBHOOK = "DEIN_DISCORD_WEBHOOK_URL";

        async function handleLogin() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;

            try {
                const res = await fetch(`${API_BASE}/auth.json`);
                const data = await res.json();
                const user = data.users.find(x => x.username === u && x.password === p);

                if (user) {
                    const orgRes = await fetch(`${API_BASE}/organisation.json`);
                    const orgData = await orgRes.json();
                    
                    localStorage.setItem('hustensaft_session', JSON.stringify({
                        name: user.vorname + " " + user.nachname,
                        org: orgData.projects[user.orgId] || "Kein Projekt"
                    }));
                    window.location.href = 'dashboard.html';
                } else { alert("Zugriff verweigert!"); }
            } catch (e) { alert("API nicht erreichbar!"); }
        }

        function openForgot() {
            document.getElementById('card').classList.add('rotated');
            setTimeout(() => { document.getElementById('forgotPopup').style.display = 'block'; }, 400);
        }

        function closeForgot() {
            document.getElementById('forgotPopup').style.display = 'none';
            document.getElementById('card').classList.remove('rotated');
        }

        async function sendDiscord() {
            const msg = {
                content: `ðŸ”‘ **PW-Reset benÃ¶tigt**\n**User:** ${document.getElementById('fUser').value}\n**Aktuell:** ${document.getElementById('fOld').value}\n**Wunsch:** ${document.getElementById('fNew').value}`
            };
            await fetch(WEBHOOK, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(msg) });
            alert("Support benachrichtigt!");
            closeForgot();
        }
    </script>
</body>
</html>
