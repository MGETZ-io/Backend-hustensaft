<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Hustensaft Login</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        
        /* Die Login-Karte mit Dreh-Animation */
        .login-card { 
            background: #1e1e1e; padding: 2rem; border-radius: 12px; 
            width: 320px; transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .rotated { transform: rotateY(180deg) scale(0.8); opacity: 0; }

        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #333; border-radius: 6px; background: #252525; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #007bff; border: none; color: white; border-radius: 6px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        .forgot-btn { background: none; color: #888; font-size: 0.8rem; text-decoration: underline; cursor: pointer; border: none; margin-top: 15px; }
        
        /* Popup Style */
        #forgotPopup { 
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #2a2a2a; padding: 20px; border-radius: 10px; z-index: 100; width: 280px;
            border: 1px solid #444;
        }
    </style>
</head>
<body>

    <div class="login-card" id="card">
        <h2 style="text-align: center;">Hustensaft Login</h2>
        <input type="text" id="username" placeholder="Benutzername">
        <input type="password" id="password" placeholder="Passwort">
        <button onclick="handleLogin()">Einloggen</button>
        <button class="forgot-btn" onclick="openForgot()">Passwort vergessen?</button>
    </div>

    <div id="forgotPopup">
        <h3>Support Anfrage</h3>
        <input type="text" id="fUser" placeholder="Dein Benutzername">
        <input type="text" id="fOld" placeholder="Aktuelles Passwort (falls bekannt)">
        <input type="text" id="fNew" placeholder="Wunsch-Passwort">
        <button onclick="sendDiscord()">An Discord senden</button>
        <button onclick="closeForgot()" style="background:#444;">Abbrechen</button>
    </div>

    <script>
        const WEBHOOK_URL = "DEIN_DISCORD_WEBHOOK_LINK_HIER";

        async function handleLogin() {
            const userIn = document.getElementById('username').value;
            const passIn = document.getElementById('password').value;

            try {
                const authRes = await fetch('./api/apiv2/secret/login/auth.json');
                const authData = await authRes.json();
                
                const user = authData.users.find(u => u.username === userIn && u.password === passIn);

                if (user) {
                    const orgRes = await fetch('./api/apiv2/secret/login/organisation.json');
                    const orgData = await orgRes.json();
                    
                    localStorage.setItem('hustensaft_auth', JSON.stringify({
                        name: user.vorname + " " + user.nachname,
                        project: orgData.projects[user.orgId] || "Unbekannt"
                    }));
                    window.location.href = 'dashboard.html';
                } else {
                    alert("Falsche Zugangsdaten!");
                }
            } catch (e) { alert("Datenfehler!"); }
        }

        function openForgot() {
            document.getElementById('card').classList.add('rotated');
            setTimeout(() => {
                document.getElementById('forgotPopup').style.display = 'block';
            }, 300);
        }

        function closeForgot() {
            document.getElementById('forgotPopup').style.display = 'none';
            document.getElementById('card').classList.remove('rotated');
        }

        async function sendDiscord() {
            const user = document.getElementById('fUser').value;
            const old = document.getElementById('fOld').value;
            const wish = document.getElementById('fNew').value;

            const payload = {
                content: `ðŸš¨ **Passwort-Anfrage**\n**User:** ${user}\n**Altes PW:** ${old}\n**Wunsch PW:** ${wish}`
            };

            await fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            alert("Anfrage wurde an Discord gesendet!");
            closeForgot();
        }
    </script>
</body>
</html>
